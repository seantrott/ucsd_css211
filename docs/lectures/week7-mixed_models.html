<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mixed Effects Models ‚Äì CSS 211: Statistical Methods for Computational Social Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">CSS 211: Statistical Methods for Computational Social Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../final_project.html"> 
<span class="menu-text">Final Project</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li>
    <a class="dropdown-item" href="../lectures/week0-intro.html">
 <span class="dropdown-text">Week 0: Course Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/week1-philosophy.html">
 <span class="dropdown-text">Week 1: Philosophy of Science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/week1-r-intro.html">
 <span class="dropdown-text">Week 1: Introduction to R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/week2-wrangling.html">
 <span class="dropdown-text">Week 2: Data Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/week3-visualization.html">
 <span class="dropdown-text">Week 3: Data Visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/week4-regression.html">
 <span class="dropdown-text">Week 4: Linear Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/week5-regression_advanced.html">
 <span class="dropdown-text">Week 5: Multiple Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/week6-logistic.html">
 <span class="dropdown-text">Week 6: Logistic Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/week7-mixed_models.html">
 <span class="dropdown-text">Week 7: Mixed Models</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-fas fa-laptop-code" role="img">
</i> 
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../labs/lab1.html">
 <span class="dropdown-text">Lab 1: R Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab2.html">
 <span class="dropdown-text">Lab 2: Wrangling and visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab3.html">
 <span class="dropdown-text">Lab 3: Regression in R</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../hands_on/week2.html">
 <span class="dropdown-text">Week 2: Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands_on/week3.html">
 <span class="dropdown-text">Week 3: Visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands_on/week4.html">
 <span class="dropdown-text">Week 4: Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands_on/week5.html">
 <span class="dropdown-text">Week 5: Multiple regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands_on/week6.html">
 <span class="dropdown-text">Week 6: Logistic regression</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../readings.html">
 <span class="dropdown-text">Readings</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/seantrott/ucsd_css211"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#goals-of-the-lecture" id="toc-goals-of-the-lecture" class="nav-link active" data-scroll-target="#goals-of-the-lecture">Goals of the lecture</a></li>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load libraries</a></li>
  <li><a href="#part-1-independence" id="toc-part-1-independence" class="nav-link" data-scroll-target="#part-1-independence">Part 1: Independence</a></li>
  <li><a href="#what-is-independence" id="toc-what-is-independence" class="nav-link" data-scroll-target="#what-is-independence">What is independence?</a></li>
  <li><a href="#why-does-independence-matter" id="toc-why-does-independence-matter" class="nav-link" data-scroll-target="#why-does-independence-matter">Why does independence matter?</a></li>
  <li><a href="#example-independent-data" id="toc-example-independent-data" class="nav-link" data-scroll-target="#example-independent-data">Example: Independent data</a></li>
  <li><a href="#another-independent-example" id="toc-another-independent-example" class="nav-link" data-scroll-target="#another-independent-example">Another independent example</a></li>
  <li><a href="#visualizing-independent-data" id="toc-visualizing-independent-data" class="nav-link" data-scroll-target="#visualizing-independent-data">Visualizing independent data</a></li>
  <li><a href="#analyzing-independent-data" id="toc-analyzing-independent-data" class="nav-link" data-scroll-target="#analyzing-independent-data">Analyzing independent data</a></li>
  <li><a href="#when-independence-fails" id="toc-when-independence-fails" class="nav-link" data-scroll-target="#when-independence-fails">When independence fails</a></li>
  <li><a href="#example-the-sleep-study" id="toc-example-the-sleep-study" class="nav-link" data-scroll-target="#example-the-sleep-study">Example: The sleep study</a></li>
  <li><a href="#naive-analysis-wrong" id="toc-naive-analysis-wrong" class="nav-link" data-scroll-target="#naive-analysis-wrong">Naive analysis (wrong!)</a></li>
  <li><a href="#the-real-structure" id="toc-the-real-structure" class="nav-link" data-scroll-target="#the-real-structure">The real structure</a></li>
  <li><a href="#subject-level-variability" id="toc-subject-level-variability" class="nav-link" data-scroll-target="#subject-level-variability">Subject-level variability</a></li>
  <li><a href="#two-types-of-nested-variance" id="toc-two-types-of-nested-variance" class="nav-link" data-scroll-target="#two-types-of-nested-variance">Two types of nested variance</a></li>
  <li><a href="#part-2-introduction-to-mixed-effects-models" id="toc-part-2-introduction-to-mixed-effects-models" class="nav-link" data-scroll-target="#part-2-introduction-to-mixed-effects-models">Part 2: Introduction to mixed effects models</a></li>
  <li><a href="#what-are-mixed-effects-models" id="toc-what-are-mixed-effects-models" class="nav-link" data-scroll-target="#what-are-mixed-effects-models">What are mixed effects models?</a></li>
  <li><a href="#fixed-vs.-random-effects" id="toc-fixed-vs.-random-effects" class="nav-link" data-scroll-target="#fixed-vs.-random-effects">Fixed vs.&nbsp;random effects</a></li>
  <li><a href="#the-mixed-model-formula" id="toc-the-mixed-model-formula" class="nav-link" data-scroll-target="#the-mixed-model-formula">The mixed model formula</a></li>
  <li><a href="#random-intercepts-intuition" id="toc-random-intercepts-intuition" class="nav-link" data-scroll-target="#random-intercepts-intuition">Random intercepts: Intuition</a></li>
  <li><a href="#random-intercepts-r-syntax" id="toc-random-intercepts-r-syntax" class="nav-link" data-scroll-target="#random-intercepts-r-syntax">Random intercepts: R syntax</a></li>
  <li><a href="#extracting-random-intercepts" id="toc-extracting-random-intercepts" class="nav-link" data-scroll-target="#extracting-random-intercepts">Extracting random intercepts</a></li>
  <li><a href="#understanding-the-intercepts" id="toc-understanding-the-intercepts" class="nav-link" data-scroll-target="#understanding-the-intercepts">Understanding the intercepts</a></li>
  <li><a href="#visualizing-random-intercepts" id="toc-visualizing-random-intercepts" class="nav-link" data-scroll-target="#visualizing-random-intercepts">Visualizing random intercepts</a></li>
  <li><a href="#random-slopes-intuition" id="toc-random-slopes-intuition" class="nav-link" data-scroll-target="#random-slopes-intuition">Random slopes: Intuition</a></li>
  <li><a href="#random-slopes-r-syntax" id="toc-random-slopes-r-syntax" class="nav-link" data-scroll-target="#random-slopes-r-syntax">Random slopes: R syntax</a></li>
  <li><a href="#extracting-random-slopes" id="toc-extracting-random-slopes" class="nav-link" data-scroll-target="#extracting-random-slopes">Extracting random slopes</a></li>
  <li><a href="#understanding-the-slopes" id="toc-understanding-the-slopes" class="nav-link" data-scroll-target="#understanding-the-slopes">Understanding the slopes</a></li>
  <li><a href="#visualizing-random-slopes" id="toc-visualizing-random-slopes" class="nav-link" data-scroll-target="#visualizing-random-slopes">Visualizing random slopes</a></li>
  <li><a href="#why-random-slopes-matter" id="toc-why-random-slopes-matter" class="nav-link" data-scroll-target="#why-random-slopes-matter">Why random slopes matter</a></li>
  <li><a href="#multiple-random-effects" id="toc-multiple-random-effects" class="nav-link" data-scroll-target="#multiple-random-effects">Multiple random effects</a></li>
  <li><a href="#conceptual-summary" id="toc-conceptual-summary" class="nav-link" data-scroll-target="#conceptual-summary">Conceptual summary</a></li>
  <li><a href="#part-3-using-lme4" id="toc-part-3-using-lme4" class="nav-link" data-scroll-target="#part-3-using-lme4">Part 3: Using <code>lme4</code></a></li>
  <li><a href="#the-lme4-package" id="toc-the-lme4-package" class="nav-link" data-scroll-target="#the-lme4-package">The <code>lme4</code> package</a></li>
  <li><a href="#building-your-first-model" id="toc-building-your-first-model" class="nav-link" data-scroll-target="#building-your-first-model">Building your first model</a></li>
  <li><a href="#viewing-model-output" id="toc-viewing-model-output" class="nav-link" data-scroll-target="#viewing-model-output">Viewing model output</a></li>
  <li><a href="#adding-random-slopes" id="toc-adding-random-slopes" class="nav-link" data-scroll-target="#adding-random-slopes">Adding random slopes</a></li>
  <li><a href="#comparing-the-models" id="toc-comparing-the-models" class="nav-link" data-scroll-target="#comparing-the-models">Comparing the models</a></li>
  <li><a href="#model-comparison-the-logic" id="toc-model-comparison-the-logic" class="nav-link" data-scroll-target="#model-comparison-the-logic">Model comparison: The logic</a></li>
  <li><a href="#running-model-comparison" id="toc-running-model-comparison" class="nav-link" data-scroll-target="#running-model-comparison">Running model comparison</a></li>
  <li><a href="#extracting-coefficients" id="toc-extracting-coefficients" class="nav-link" data-scroll-target="#extracting-coefficients">Extracting coefficients</a></li>
  <li><a href="#visualizing-random-effects" id="toc-visualizing-random-effects" class="nav-link" data-scroll-target="#visualizing-random-effects">Visualizing random effects</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week7-r-multilevel-slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mixed Effects Models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="goals-of-the-lecture" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="goals-of-the-lecture">Goals of the lecture</h2>
<div class="incremental">
<ul class="incremental">
<li>The <strong>independence assumption</strong> of linear regression.
<ul class="incremental">
<li>What about when data are <em>non-independent</em>?</li>
</ul></li>
<li>Introducing <strong>mixed effects models</strong>.
<ul class="incremental">
<li>Fixed vs.&nbsp;random effects.</li>
<li>Adding <em>random intercepts</em>.</li>
<li>Adding <em>random slopes</em>.</li>
</ul></li>
<li>Mixed models <strong>in practice</strong> with <code>lme4</code>.
<ul class="incremental">
<li>Model comparison: the logic of <em>likelihood-ratio tests</em>.</li>
</ul></li>
</ul>
</div>
</section>
<section id="load-libraries" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries">Load libraries</h2>
<div class="cell" data-output-location="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="do">### Loading the tidyverse</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Attaching core tidyverse packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 2.0.0 ‚îÄ‚îÄ
‚úî dplyr     1.1.4     ‚úî readr     2.1.5
‚úî forcats   1.0.0     ‚úî stringr   1.5.1
‚úî ggplot2   3.5.2     ‚úî tibble    3.2.1
‚úî lubridate 1.9.4     ‚úî tidyr     1.3.1
‚úî purrr     1.0.4     
‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ
‚úñ dplyr::filter() masks stats::filter()
‚úñ dplyr::lag()    masks stats::lag()
‚Ñπ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="do">### Loading lme4</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(lme4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix

Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
</div>
</section>
<section id="part-1-independence" class="level2">
<h2 class="anchored" data-anchor-id="part-1-independence">Part 1: Independence</h2>
<p>The independence assumption; why it matters; examples of <em>non-independence</em>.</p>
</section>
<section id="what-is-independence" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="what-is-independence">What is independence?</h2>
<blockquote class="blockquote">
<p><strong>Independence</strong> means that each observation in your dataset is generated by a separate, unrelated causal process.</p>
</blockquote>
<div class="incremental">
<ul class="incremental">
<li>When you flip a coin, each flip is independent of the others</li>
<li>The outcome of flip #1 doesn‚Äôt influence flip #2</li>
<li>No hidden factors connect multiple observations</li>
<li>Each data point provides <em>new</em> information</li>
</ul>
</div>
<div class="notes">
<p>Independence is a fundamental assumption of many statistical tests. When we assume independence, we‚Äôre saying that knowing the value of one observation tells us nothing about another observation beyond what our model predicts.</p>
</div>
</section>
<section id="why-does-independence-matter" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="why-does-independence-matter">Why does independence matter?</h2>
<p>Standard statistical methods (t-tests, OLS regression, ANOVA) assume independence.</p>
<p><strong>When this assumption is violated:</strong></p>
<div class="incremental">
<ul class="incremental">
<li>Standard errors are underestimated</li>
<li>Confidence intervals are too narrow<br>
</li>
<li>p-values are too small (inflated Type I error)</li>
<li>Your conclusions may be wrong!</li>
</ul>
</div>
<div class="fragment">
<p><strong>The problem:</strong> Treating non-independent observations as independent makes you overconfident in your results.</p>
</div>
</section>
<section id="example-independent-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="example-independent-data">Example: Independent data</h2>
<p>You test whether a new drug increases happiness:</p>
<div class="incremental">
<ul class="incremental">
<li>100 people receive the drug</li>
<li>100 people receive a placebo</li>
<li>Each person provides <strong>one</strong> happiness rating (1-7 scale)</li>
<li>You compare the two groups with a t-test</li>
</ul>
</div>
<div class="fragment">
<p>‚úì <strong>Independence is reasonable here</strong><br>
Each person contributes exactly one data point.</p>
</div>
</section>
<section id="another-independent-example" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="another-independent-example">Another independent example</h2>
<p>You test whether people respond differently to metaphor type A vs.&nbsp;B:</p>
<div class="incremental">
<ul class="incremental">
<li>200 participants, randomly assigned to condition A or B</li>
<li>Each participant sees <strong>one</strong> item</li>
<li>Between-subjects design with one item per person</li>
<li>Compare responses with OLS regression</li>
</ul>
</div>
<div class="fragment">
<p>‚úì <strong>Independence is reasonable here</strong><br>
No repeated measures, no item effects to worry about.</p>
</div>
</section>
<section id="visualizing-independent-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="visualizing-independent-data">Visualizing independent data</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week7-mixed_models_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Each observation is independent‚Äîno nesting structure.</p>
</section>
<section id="analyzing-independent-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="analyzing-independent-data">Analyzing independent data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>simple_model <span class="ot">=</span> <span class="fu">lm</span>(<span class="at">data =</span> df, value <span class="sc">~</span> group)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simple_model)<span class="sc">$</span>coefficients</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error    t value      Pr(&gt;|t|)
(Intercept) 725.28182   1.483120 489.024307 3.981800e-307
groupB      -20.63247   2.097449  -9.836938  7.625833e-19</code></pre>
</div>
</div>
<div class="fragment">
<p><strong>Interpretation:</strong> - Intercept (groupA) = 725.28 (mean of group A) - groupB coefficient = -20.63 (difference from A) - Group B is about 20 units lower than Group A</p>
</div>
</section>
<section id="when-independence-fails" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="when-independence-fails">When independence fails</h2>
<blockquote class="blockquote">
<p><em>Non-independence</em> occurs when different observations are systematically related, i.e., they were produced by the same generative process.</p>
</blockquote>
<p><strong>Common sources of non-independence in behavioral research:</strong></p>
<div class="incremental">
<ul class="incremental">
<li><strong>Repeated measures</strong>: Same participant tested multiple times</li>
<li><strong>Nested data</strong>: Students within classrooms within schools</li>
<li><strong>Stimulus items</strong>: Same stimuli shown to multiple participants<br>
</li>
<li><strong>Time series</strong>: Measurements over time from same units</li>
<li><strong>Clustered designs</strong>: Participants recruited from same communities</li>
</ul>
</div>
</section>
<section id="example-the-sleep-study" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="example-the-sleep-study">Example: The sleep study</h2>
<p>The <code>sleepstudy</code> dataset tracks reaction times in 18 subjects over subsequent days of sleep deprivation:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(sleepstudy)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sleepstudy, <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Reaction Days Subject
1 249.5600    0     308
2 258.7047    1     308
3 250.8006    2     308</code></pre>
</div>
</div>
<div class="fragment">
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üí≠ Check-in
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on the structure of this study, what might be a source of non-independence?</p>
</div>
</div>
</div>
</section>
<section id="naive-analysis-wrong" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="naive-analysis-wrong">Naive analysis (wrong!)</h2>
<p>Let‚Äôs pretend we don‚Äôt know about the nested structure:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sleepstudy <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Naive analysis: treating all 180 observations as independent"</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week7-mixed_models_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üí≠ Check-in
</div>
</div>
<div class="callout-body-container callout-body">
<p>What‚Äôs not pictured here?</p>
</div>
</div>
</div>
</section>
<section id="the-real-structure" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="the-real-structure">The real structure</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week7-mixed_models_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p><strong>Subjects differ in:</strong></p>
<ul>
<li>Overall reaction time (baseline speed)<br>
</li>
<li>Effect of sleep deprivation (some are more resilient)</li>
</ul>
</section>
<section id="subject-level-variability" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="subject-level-variability">Subject-level variability</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week7-mixed_models_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Some subjects are consistently faster; others are consistently slower.</p>
</section>
<section id="two-types-of-nested-variance" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="two-types-of-nested-variance">Two types of nested variance</h2>
<div class="incremental">
<ol class="incremental" type="1">
<li><strong>Random intercepts</strong>: Subjects differ in their average reaction time
<ul class="incremental">
<li>Some people are just faster/slower overall</li>
<li>Even with no sleep deprivation!</li>
</ul></li>
<li><strong>Random slopes</strong>: Subjects differ in <em>how much</em> sleep deprivation affects them
<ul class="incremental">
<li>Some people are resilient (shallow slope)</li>
<li>Others deteriorate quickly (steep slope)</li>
</ul></li>
</ol>
</div>
<div class="fragment">
<p><strong>Mixed effects models</strong> let us account for both types of variance.</p>
</div>
</section>
<section id="part-2-introduction-to-mixed-effects-models" class="level2">
<h2 class="anchored" data-anchor-id="part-2-introduction-to-mixed-effects-models">Part 2: Introduction to mixed effects models</h2>
<p>Fixed vs.&nbsp;random effects; random intercepts; random slopes.</p>
</section>
<section id="what-are-mixed-effects-models" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="what-are-mixed-effects-models">What are mixed effects models?</h2>
<p><strong>Mixed effects models</strong> combine:</p>
<div class="incremental">
<ul class="incremental">
<li><strong>Fixed effects</strong>: Variables we care about (e.g., experimental conditions)
<ul class="incremental">
<li>These are your hypotheses!</li>
<li>Estimated with specific coefficient values</li>
</ul></li>
<li><strong>Random effects</strong>: Grouping variables that create non-independence
<ul class="incremental">
<li>Sources of variability we need to control for</li>
<li>Allow intercepts/slopes to vary by group</li>
<li>Estimated as distributions (variance parameters)</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<p><strong>Goal:</strong> Get better estimates of fixed effects by accounting for nested structure.</p>
</div>
</section>
<section id="fixed-vs.-random-effects" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="fixed-vs.-random-effects">Fixed vs.&nbsp;random effects</h2>
<p>Determining which factors to include as <em>fixed</em> vs.&nbsp;<em>random</em> effects is not always straightforward. Here‚Äôs a rough guide, but we‚Äôll discuss it again later too:</p>
<p><strong>How do you decide?</strong></p>
<div class="incremental">
<ul class="incremental">
<li><strong>Fixed effects</strong>:
<ul class="incremental">
<li>Variables you‚Äôre theoretically interested in</li>
<li>Want to estimate specific coefficient values</li>
<li>Often <em>experimental manipulations</em></li>
<li>Examples: treatment condition, time, drug dosage</li>
</ul></li>
<li><strong>Random effects</strong>:
<ul class="incremental">
<li>Grouping/clustering variables</li>
<li>Want to account for variance, not estimate specific values</li>
<li>Usually <em>sampling from larger population</em></li>
<li>Examples: participant ID, item ID, school, lab</li>
</ul></li>
</ul>
</div>
</section>
<section id="the-mixed-model-formula" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="the-mixed-model-formula">The mixed model formula</h2>
<p>Standard regression:</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1 X + \epsilon\]</span></p>
<p>Mixed effects model with random intercepts:</p>
<p><span class="math display">\[Y = (\beta_0 + u_0) + \beta_1 X + \epsilon\]</span></p>
<div class="fragment">
<p>Where:</p>
<ul>
<li><span class="math inline">\(\beta_0\)</span> = overall intercept (fixed effect)</li>
<li><span class="math inline">\(u_0\)</span> = subject-specific deviation from overall intercept (random effect)</li>
<li><span class="math inline">\(\beta_1\)</span> = fixed effect of X</li>
<li><span class="math inline">\(\epsilon\)</span> = residual error</li>
</ul>
</div>
</section>
<section id="random-intercepts-intuition" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="random-intercepts-intuition">Random intercepts: Intuition</h2>
<p><strong>Random intercepts</strong> allow each group (e.g., subject) to have its own baseline:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week7-mixed_models_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Same slope, different intercepts.</p>
</section>
<section id="random-intercepts-r-syntax" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="random-intercepts-r-syntax">Random intercepts: R syntax</h2>
<p><strong>Basic model with random intercepts:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>model_intercepts <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Subject), </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> sleepstudy)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Breaking down the syntax:</strong></p>
<div class="incremental">
<ul class="incremental">
<li><code>Reaction ~ Days</code>: Fixed effect of Days on Reaction</li>
<li><code>(1 | Subject)</code>: Random intercept for each Subject
<ul class="incremental">
<li><code>1</code> = intercept</li>
<li><code>|</code> = ‚Äúgrouped by‚Äù</li>
<li><code>Subject</code> = grouping variable</li>
</ul></li>
</ul>
</div>
</section>
<section id="extracting-random-intercepts" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="extracting-random-intercepts">Extracting random intercepts</h2>
<p><strong>After fitting the model, you can extract the random effects:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract random intercepts</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>random_int <span class="ot">&lt;-</span> <span class="fu">ranef</span>(model_intercepts)<span class="sc">$</span>Subject</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(random_int, <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    (Intercept)
308   40.783710
309  -77.849554
310  -63.108567
330    4.406442</code></pre>
</div>
</div>
<div class="fragment">
<p>These are <strong>deviations</strong> from the overall intercept (fixed effect).</p>
</div>
</section>
<section id="understanding-the-intercepts" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="understanding-the-intercepts">Understanding the intercepts</h2>
<p><strong>Each subject‚Äôs fitted intercept = fixed intercept + random deviation:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall (fixed) intercept</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fixed_intercept <span class="ot">&lt;-</span> <span class="fu">fixef</span>(model_intercepts)[<span class="st">"(Intercept)"</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>fixed_intercept</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   251.4051 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subject 308's total intercept</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>subject_308_deviation <span class="ot">&lt;-</span> <span class="fu">ranef</span>(model_intercepts)<span class="sc">$</span>Subject[<span class="st">"308"</span>, <span class="st">"(Intercept)"</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>subject_308_deviation</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40.78371</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>subject_308_total <span class="ot">&lt;-</span> fixed_intercept <span class="sc">+</span> subject_308_deviation</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>subject_308_total</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   292.1888 </code></pre>
</div>
</div>
</section>
<section id="visualizing-random-intercepts" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="visualizing-random-intercepts">Visualizing random intercepts</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe of random intercepts</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>intercept_df <span class="ot">&lt;-</span> <span class="fu">ranef</span>(model_intercepts)<span class="sc">$</span>Subject <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Subject"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">deviation =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(intercept_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Subject, deviation), <span class="at">y =</span> deviation)) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Random intercept deviations by subject"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Subject"</span>, <span class="at">y =</span> <span class="st">"Deviation from fixed intercept (ms)"</span>) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week7-mixed_models_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="random-slopes-intuition" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="random-slopes-intuition">Random slopes: Intuition</h2>
<p><strong>Random slopes</strong> allow the effect of X to vary by group:</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week7-mixed_models_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="random-slopes-r-syntax" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="random-slopes-r-syntax">Random slopes: R syntax</h2>
<p><strong>Model with random intercepts AND slopes:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>model_slopes <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">|</span> Subject), </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> sleepstudy)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_slopes)<span class="sc">$</span>coefficients</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error   t value
(Intercept) 251.40510   6.824597 36.838090
Days         10.46729   1.545790  6.771481</code></pre>
</div>
</div>
<p><strong>Breaking down the syntax:</strong></p>
<div class="incremental">
<ul class="incremental">
<li><code>Reaction ~ Days</code>: Fixed effect of Days</li>
<li><code>(1 + Days | Subject)</code>: Random effects for Subject
<ul class="incremental">
<li><code>1</code> = random intercept</li>
<li><code>Days</code> = random slope for Days</li>
<li><code>|</code> = grouped by</li>
<li><code>Subject</code> = grouping variable</li>
</ul></li>
</ul>
</div>
</section>
<section id="extracting-random-slopes" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="extracting-random-slopes">Extracting random slopes</h2>
<p><strong>After fitting the model, you can extract the random effects:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract random intercepts</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>random_eff <span class="ot">&lt;-</span> <span class="fu">ranef</span>(model_slopes)<span class="sc">$</span>Subject</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(random_eff, <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    (Intercept)      Days
308    2.258551  9.198976
309  -40.398738 -8.619681
310  -38.960409 -5.448856
330   23.690620 -4.814350</code></pre>
</div>
</div>
<div class="fragment">
<p>Now, we have deviations from the <em>intercept</em> and from the <em>Days</em> slope.</p>
</div>
</section>
<section id="understanding-the-slopes" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="understanding-the-slopes">Understanding the slopes</h2>
<p><strong>Each subject‚Äôs fitted slope = fixed slope + random deviation:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall (fixed) slope for Days</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fixed_slope <span class="ot">&lt;-</span> <span class="fu">fixef</span>(model_slopes)[<span class="st">"Days"</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>fixed_slope</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Days 
10.46729 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subject 308's slope deviation and total slope</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>subject_308_slope_dev <span class="ot">&lt;-</span> <span class="fu">ranef</span>(model_slopes)<span class="sc">$</span>Subject[<span class="st">"308"</span>, <span class="st">"Days"</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>subject_308_slope_dev</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.198976</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>subject_308_total_slope <span class="ot">&lt;-</span> fixed_slope <span class="sc">+</span> subject_308_slope_dev</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>subject_308_total_slope</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Days 
19.66626 </code></pre>
</div>
</div>
<div class="fragment">
<p>Subject 308‚Äôs RT increases by ~19.67 ms per day (vs.&nbsp;population average of ~10.47 ms).</p>
</div>
</section>
<section id="visualizing-random-slopes" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="visualizing-random-slopes">Visualizing random slopes</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe of random effects</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>slopes_df <span class="ot">&lt;-</span> <span class="fu">ranef</span>(model_slopes)<span class="sc">$</span>Subject <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Subject"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">intercept_dev =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>, <span class="at">slope_dev =</span> Days)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(slopes_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Subject, slope_dev), <span class="at">y =</span> slope_dev)) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Random slope deviations by subject"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Subject"</span>, <span class="at">y =</span> <span class="st">"Deviation from fixed slope (ms/day)"</span>) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week7-mixed_models_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="why-random-slopes-matter" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="why-random-slopes-matter">Why random slopes matter</h2>
<p><strong>Without random slopes:</strong> - Assumes the effect is the same for everyone - Underestimates uncertainty in the fixed effect - Can lead to false positives</p>
<p><strong>With random slopes:</strong> - Acknowledges that effects vary across individuals - Provides more conservative (realistic) estimates - Better generalization to new subjects</p>
<div class="fragment">
<p><strong>Rule of thumb:</strong> If a variable varies within your grouping variable, include it as a random slope.</p>
</div>
</section>
<section id="multiple-random-effects" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="multiple-random-effects">Multiple random effects</h2>
<p>You can include multiple sources of random effects:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random effects for both subjects and items</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(RT <span class="sc">~</span> Condition <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                (<span class="dv">1</span> <span class="sc">+</span> Condition <span class="sc">|</span> Subject) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                (<span class="dv">1</span> <span class="sc">+</span> Condition <span class="sc">|</span> Item),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> mydata)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="fragment">
<p><strong>Common in psycholinguistics:</strong> - Random effects for subjects (people vary) - Random effects for items (stimuli vary) - Called ‚Äúcrossed random effects‚Äù</p>
</div>
</section>
<section id="conceptual-summary" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="conceptual-summary">Conceptual summary</h2>
<p><strong>Mixed effects models help when:</strong></p>
<div class="incremental">
<ul class="incremental">
<li>You have repeated measures</li>
<li>You have nested/hierarchical structure</li>
<li>You want to generalize beyond your specific sample</li>
</ul>
</div>
<div class="fragment">
<p><strong>Key components:</strong> - <strong>Fixed effects</strong>: Your hypotheses - <strong>Random intercepts</strong>: Group-level baseline differences<br>
- <strong>Random slopes</strong>: Group-level differences in effects</p>
</div>
</section>
<section id="part-3-using-lme4" class="level2">
<h2 class="anchored" data-anchor-id="part-3-using-lme4">Part 3: Using <code>lme4</code></h2>
<p>Building and evaluating models; model comparisons; best practices and common issues.</p>
</section>
<section id="the-lme4-package" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="the-lme4-package">The <code>lme4</code> package</h2>
<p><strong>Most common R package for mixed models:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="fragment">
<p><strong>Main functions:</strong> - <code>lmer()</code>: Linear mixed effects models - <code>glmer()</code>: Generalized linear mixed models (logistic, Poisson, etc.)</p>
</div>
</section>
<section id="building-your-first-model" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="building-your-first-model">Building your first model</h2>
<p>Let‚Äôs fit a model with random intercepts only:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>model_intercepts <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Subject),</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> sleepstudy,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">REML =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="fragment">
<p><strong>Note:</strong> <code>REML = FALSE</code> uses maximum likelihood estimation, which we need for model comparison.</p>
</div>
</section>
<section id="viewing-model-output" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="viewing-model-output">Viewing model output</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_intercepts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by maximum likelihood  ['lmerMod']
Formula: Reaction ~ Days + (1 | Subject)
   Data: sleepstudy

      AIC       BIC    logLik -2*log(L)  df.resid 
   1802.1    1814.9    -897.0    1794.1       176 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.2347 -0.5544  0.0155  0.5257  4.2648 

Random effects:
 Groups   Name        Variance Std.Dev.
 Subject  (Intercept) 1296.9   36.01   
 Residual              954.5   30.90   
Number of obs: 180, groups:  Subject, 18

Fixed effects:
            Estimate Std. Error t value
(Intercept) 251.4051     9.5062   26.45
Days         10.4673     0.8017   13.06

Correlation of Fixed Effects:
     (Intr)
Days -0.380</code></pre>
</div>
</div>
</section>
<section id="adding-random-slopes" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="adding-random-slopes">Adding random slopes</h2>
<p>Now let‚Äôs add random slopes for the Days effect:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">|</span> Subject),</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> sleepstudy,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">REML =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This allows both the intercept AND the slope to vary by subject.</p>
</section>
<section id="comparing-the-models" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="comparing-the-models">Comparing the models</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by maximum likelihood  ['lmerMod']
Formula: Reaction ~ Days + (1 + Days | Subject)
   Data: sleepstudy

      AIC       BIC    logLik -2*log(L)  df.resid 
   1763.9    1783.1    -876.0    1751.9       174 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.9416 -0.4656  0.0289  0.4636  5.1793 

Random effects:
 Groups   Name        Variance Std.Dev. Corr
 Subject  (Intercept) 565.48   23.780       
          Days         32.68    5.717   0.08
 Residual             654.95   25.592       
Number of obs: 180, groups:  Subject, 18

Fixed effects:
            Estimate Std. Error t value
(Intercept)  251.405      6.632  37.907
Days          10.467      1.502   6.968

Correlation of Fixed Effects:
     (Intr)
Days -0.138</code></pre>
</div>
</div>
</section>
<section id="model-comparison-the-logic" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="model-comparison-the-logic">Model comparison: The logic</h2>
<p><strong>Question:</strong> Does adding variable <span class="math inline">\(X\)</span> improve the model over a model without <span class="math inline">\(X\)</span>?</p>
<p><strong>Approach: Likelihood ratio test</strong></p>
<div class="incremental">
<ul class="incremental">
<li>Compare <strong>log-likelihood</strong> of two nested models</li>
<li>Model with more parameters should fit better</li>
<li>But: is the improvement ‚Äúworth it‚Äù?</li>
<li>Test statistic: <span class="math inline">\(\chi^2 = -2(LL_{reduced} - LL_{full})\)</span></li>
<li>Compare to chi-square distribution</li>
</ul>
</div>
</section>
<section id="running-model-comparison" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="running-model-comparison">Running model comparison</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">|</span> Subject),</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> sleepstudy,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>model_reduced <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">|</span> Subject),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> sleepstudy,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model_full, model_reduced)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: sleepstudy
Models:
model_reduced: Reaction ~ (1 + Days | Subject)
model_full: Reaction ~ Days + (1 + Days | Subject)
              npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)    
model_reduced    5 1785.5 1801.4 -887.74    1775.5                         
model_full       6 1763.9 1783.1 -875.97    1751.9 23.537  1  1.226e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="fragment">
<p><strong>Interpretation:</strong>: Adding <code>Days</code> significantly improves fit</p>
</div>
</section>
<section id="extracting-coefficients" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="extracting-coefficients">Extracting coefficients</h2>
<p><strong>Fixed effects (population-level):</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(model_full)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        Days 
  251.40510    10.46729 </code></pre>
</div>
</div>
<p><strong>Random effects (subject-specific deviations):</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">ranef</span>(model_full)<span class="sc">$</span>Subject, <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    (Intercept)      Days
308    2.815789  9.075507
309  -40.047855 -8.644152
310  -38.432497 -5.513471
330   22.831765 -4.658665</code></pre>
</div>
</div>
</section>
<section id="visualizing-random-effects" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="visualizing-random-effects">Visualizing random effects</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>ranef_df <span class="ot">&lt;-</span> <span class="fu">ranef</span>(model_full)<span class="sc">$</span>Subject <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Subject"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ranef_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>, <span class="at">y =</span> Days)) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Random effects for each subject"</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Random intercept"</span>, <span class="at">y =</span> <span class="st">"Random slope for Days"</span>) <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week7-mixed_models_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conclusion" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="conclusion">Conclusion</h2>
<div class="incremental">
<ul class="incremental">
<li>Mixed models are a valuable tool for modeling <em>non-independent data</em>.</li>
<li>Random intercetps model correlated variance in <code>y</code>; random slopes model correlated variance in <code>y ~ x</code>.</li>
<li>Coming up, we‚Äôll discuss:
<ul class="incremental">
<li>More complex models (e.g., nested variance).</li>
<li>Deep dive into fitting random effects (e.g., <em>pooling</em>).</li>
<li>Understanding the outputs (e.g., variance partitioning).</li>
<li>Best practices (e.g., ‚Äúkeep it maximal‚Äù).</li>
<li>Diagnozing and fixing common issues (e.g., convergence failures).</li>
<li>Generalizing to <em>generalized linear mixed effects models</em>.</li>
</ul></li>
</ul>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>